import { Subject } from '../Subject';
<<<<<<< HEAD
import { OuterSubscriber } from '../OuterSubscriber';
import { subscribeToResult } from '../util/subscribeToResult';
=======
import { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';
>>>>>>> 6f5fd4790114a9d761d96ca3fbe8e8e19e12c4a4
export function repeatWhen(notifier) {
    return (source) => source.lift(new RepeatWhenOperator(notifier));
}
class RepeatWhenOperator {
    constructor(notifier) {
        this.notifier = notifier;
    }
    call(subscriber, source) {
        return source.subscribe(new RepeatWhenSubscriber(subscriber, this.notifier, source));
    }
}
<<<<<<< HEAD
class RepeatWhenSubscriber extends OuterSubscriber {
=======
class RepeatWhenSubscriber extends SimpleOuterSubscriber {
>>>>>>> 6f5fd4790114a9d761d96ca3fbe8e8e19e12c4a4
    constructor(destination, notifier, source) {
        super(destination);
        this.notifier = notifier;
        this.source = source;
        this.sourceIsBeingSubscribedTo = true;
    }
<<<<<<< HEAD
    notifyNext(outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        this.sourceIsBeingSubscribedTo = true;
        this.source.subscribe(this);
    }
    notifyComplete(innerSub) {
=======
    notifyNext() {
        this.sourceIsBeingSubscribedTo = true;
        this.source.subscribe(this);
    }
    notifyComplete() {
>>>>>>> 6f5fd4790114a9d761d96ca3fbe8e8e19e12c4a4
        if (this.sourceIsBeingSubscribedTo === false) {
            return super.complete();
        }
    }
    complete() {
        this.sourceIsBeingSubscribedTo = false;
        if (!this.isStopped) {
            if (!this.retries) {
                this.subscribeToRetries();
            }
            if (!this.retriesSubscription || this.retriesSubscription.closed) {
                return super.complete();
            }
            this._unsubscribeAndRecycle();
<<<<<<< HEAD
            this.notifications.next();
=======
            this.notifications.next(undefined);
>>>>>>> 6f5fd4790114a9d761d96ca3fbe8e8e19e12c4a4
        }
    }
    _unsubscribe() {
        const { notifications, retriesSubscription } = this;
        if (notifications) {
            notifications.unsubscribe();
<<<<<<< HEAD
            this.notifications = null;
        }
        if (retriesSubscription) {
            retriesSubscription.unsubscribe();
            this.retriesSubscription = null;
        }
        this.retries = null;
=======
            this.notifications = undefined;
        }
        if (retriesSubscription) {
            retriesSubscription.unsubscribe();
            this.retriesSubscription = undefined;
        }
        this.retries = undefined;
>>>>>>> 6f5fd4790114a9d761d96ca3fbe8e8e19e12c4a4
    }
    _unsubscribeAndRecycle() {
        const { _unsubscribe } = this;
        this._unsubscribe = null;
        super._unsubscribeAndRecycle();
        this._unsubscribe = _unsubscribe;
        return this;
    }
    subscribeToRetries() {
        this.notifications = new Subject();
        let retries;
        try {
            const { notifier } = this;
            retries = notifier(this.notifications);
        }
        catch (e) {
            return super.complete();
        }
        this.retries = retries;
<<<<<<< HEAD
        this.retriesSubscription = subscribeToResult(this, retries);
=======
        this.retriesSubscription = innerSubscribe(retries, new SimpleInnerSubscriber(this));
>>>>>>> 6f5fd4790114a9d761d96ca3fbe8e8e19e12c4a4
    }
}
//# sourceMappingURL=repeatWhen.js.map